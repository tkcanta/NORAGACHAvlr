# 「野良ガチャVALORANT」仕様書

## 1. サービス概要

「野良ガチャVALORANT」は、VALORANTプレイヤーがチーム構成をシミュレーションできるウェブサービスです。ユーザーが自分の名前とプレイするエージェントを選択すると、残りの4人の野良プレイヤーとそのエージェントがランダムに生成されます。生成されたチーム構成はOGP画像として自動生成され、ソーシャルメディア（特にX/Twitter）で共有することができます。

60%の確率で「害悪な野良プレイヤー」が生成され、そのキャラクターは特定のセリフを表示します。エージェントの重複は許可されず、5人全員が異なるエージェントを使用することになります。

## 2. 技術仕様

### 使用技術
- フロントエンド: HTML5, CSS3, JavaScript
- バックエンド: PHP
- データベース: MySQL
- UIフレームワーク: Bootstrap 5（レスポンシブデザイン）
- サーバー: Apache/Nginx

### 開発環境
- ローカル開発環境: XAMPP/MAMP
- バージョン管理: Git/GitHub

## 3. システム構成

### データベース設計

**テーブル: users**
- id (INT, PK, AUTO_INCREMENT)
- username (VARCHAR)
- selected_agent_id (INT)
- created_at (TIMESTAMP)
- session_id (VARCHAR)

**テーブル: agents**
- id (INT, PK)
- name (VARCHAR) - 英語名（例: "Jett"）
- display_name_ja (VARCHAR) - 日本語表示名（例: "ジェット"）
- role (VARCHAR) - 役割（デュエリスト、センチネルなど）
- image_path (VARCHAR) - エージェント画像のパス

**テーブル: random_players**
- id (INT, PK, AUTO_INCREMENT)
- name (VARCHAR) - ランダムな野良プレイヤー名
- is_toxic (BOOLEAN) - 害悪プレイヤーかどうか

**テーブル: toxic_phrases**
- id (INT, PK, AUTO_INCREMENT)
- phrase (TEXT) - 害悪プレイヤーのセリフ
- agent_id (INT, FK) - 特定のエージェント用のセリフの場合（NULL可）

**テーブル: team_compositions**
- id (INT, PK, AUTO_INCREMENT)
- user_id (INT, FK)
- composition_hash (VARCHAR) - チーム構成の一意のハッシュ
- ogp_image_path (VARCHAR) - 生成されたOGP画像のパス
- created_at (TIMESTAMP)

**テーブル: composition_agents**
- id (INT, PK, AUTO_INCREMENT)
- composition_id (INT, FK)
- agent_id (INT, FK)
- player_name (VARCHAR)
- is_user (BOOLEAN) - ユーザー自身かどうか
- is_toxic (BOOLEAN) - 害悪プレイヤーかどうか
- toxic_phrase (TEXT, NULL) - 害悪プレイヤーの場合のセリフ

### データベース接続設定
- ホスト: localhost
- データベース名: noragacha_valorant
- ユーザー名: noragacha_user
- パスワード: password123
- ポート: 3306

## 4. 画面設計と遷移

### 画面一覧
1. **トップページ（Home）**
2. **エージェント選択画面**
3. **結果表示画面**
4. **共有画面**

### 画面遷移フロー
```
Home → エージェント選択 → 結果表示 → 共有
```

### 各画面の詳細

#### 4.1 トップページ（Home）
- ヘッダー: サービス名「野良ガチャVALORANT」ロゴ
- メインコンテンツ:
  - サービス説明（簡潔な説明文）
  - 「始める」ボタン
  - 最近生成されたチーム構成のプレビュー（最大3件）
- フッター: 著作権表示、プライバシーポリシーへのリンク

#### 4.2 エージェント選択画面
- ヘッダー: サービス名、「戻る」ボタン
- フォーム:
  - ユーザー名入力フィールド（必須）
  - エージェント選択セクション:
    - 役割ごとにグループ化されたエージェントアイコン一覧
    - 各アイコンは選択可能
    - 現在選択中のエージェントは視覚的に強調表示
  - 「ガチャを回す」ボタン
- フッター: 著作権表示

#### 4.3 結果表示画面
- ヘッダー: サービス名、「もう一度」ボタン
- メインコンテンツ:
  - チーム構成の表示:
    - ユーザーと選択したエージェント（画像と名前）
    - ランダム生成された4人の野良プレイヤーとそのエージェント
    - 害悪プレイヤーがいる場合は、そのプレイヤーのセリフをバブル表示
  - チーム構成の評価（バランス、攻撃力、防御力などの簡単な評価）
  - 「Xで共有」ボタン
  - 画像として保存ボタン
- フッター: 著作権表示

#### 4.4 共有画面
- OGP画像のプレビュー
- 共有用URL
- SNSシェアボタン（X、Facebook、LINEなど）
- 「結果に戻る」ボタン
- 「新しいガチャを回す」ボタン

## 5. 機能詳細

### 5.1 ユーザー名とエージェント選択
- ユーザーは任意の名前（2〜12文字）を入力可能
- エージェントは役割別（デュエリスト、センチネル、イニシエーター、コントローラー）にグループ化されて表示
- 選択されたエージェントは視覚的にハイライト表示される

### 5.2 ランダム野良プレイヤー生成
- 残り4人のプレイヤーはランダムな名前で生成
- 名前のバリエーションは50種類以上用意
- 各プレイヤーは未選択のエージェントからランダムに割り当て（重複なし）
- 60%の確率で、4人のうち1〜2人が「害悪プレイヤー」として生成される

### 5.3 害悪プレイヤーのセリフ生成
- 害悪プレイヤーには以下のようなセリフがランダムに割り当てられる:
  - 一般的な煽りセリフ
  - エージェント特有のセリフ
  - ゲーム状況に応じたセリフ
- セリフはデータベースから適切なものがランダムに選択される

### 5.4 チーム構成の評価
- チームのバランス（攻撃、防御、サポート能力など）を簡易的に評価
- 役割の分布に基づいて簡単なコメントを表示（例: 「攻撃的な構成です」「バランスの取れたチームです」）

### 5.5 OGP画像生成
- チーム構成（5人のプレイヤー名とエージェント）を含むOGP画像を自動生成
- 害悪プレイヤーのセリフも画像に含める
- 画像サイズ: 1200×630px（SNS共有に最適化）
- 画像にはサービス名「野良ガチャVALORANT」のロゴも含める

### 5.6 共有機能
- 生成された結果を直接Xに投稿するボタン
- 投稿時のデフォルトテキスト: 「VALORANTで野良と組んでみた結果... #野良ガチャVALORANT #VALORANT」
- 共有URL（結果を直接表示できるユニークURL）

## 6. 非機能要件

### 6.1 パフォーマンス
- ページ読み込み時間: 3秒以内
- OGP画像生成: 5秒以内
- サーバーレスポンス時間: 1秒以内

### 6.2 セキュリティ
- 入力値のバリデーションと無害化
- SQLインジェクション対策
- XSS対策
- 管理画面のセキュリティ（ベーシック認証）

### 6.3 レスポンシブデザイン
- 対応デバイス:
  - デスクトップ（1920px〜1024px）
  - タブレット（1023px〜768px）
  - スマートフォン（767px〜320px）
- Bootstrap 5を使用したレスポンシブデザイン

### 6.4 アクセシビリティ
- 色覚異常を考慮した色使い
- 適切なコントラスト比
- 適切なアルトテキスト

## 7. 管理画面

### 7.1 管理機能
- ログイン認証（ユーザー名: admin、パスワード: admin123）
- チーム構成の管理（一覧表示、詳細表示、削除）
- プレイヤー管理（追加、編集、削除）
- セリフ管理（追加、編集、削除）
- エージェント管理（追加、編集）

### 7.2 管理画面のセキュリティ
- セッションベースの認証
- ブルートフォース攻撃対策
- 適切な権限管理

## 8. バージョン管理とデプロイメント

### 8.1 バージョン管理
- GitHubを使用したソースコード管理
- 機能ごとのブランチ開発
- プルリクエストとコードレビュー

### 8.2 デプロイメント
- マニュアルデプロイ
- データベースのマイグレーション
- 設定ファイルの環境別管理

## 9. 拡張性と将来的な機能

### 9.1 拡張性
- 新しいエージェントが追加された場合の対応
- データベースへの新エージェント追加のみで対応可能な設計

### 9.2 将来的な機能案
- ユーザーアカウント機能（過去の生成結果の保存）
- チーム構成の評価の詳細化
- マップごとの勝率予測
- 実際のプレイヤー統計との連携
- カスタム害悪プレイヤーの作成機能

## 10. テスト計画

### 10.1 機能テスト
- ユーザー名入力と検証
- エージェント選択と重複防止
- ランダム生成アルゴリズム
- 害悪プレイヤー生成確率
- OGP生成と共有機能

### 10.2 互換性テスト
- ブラウザ互換性（Chrome, Firefox, Safari, Edge）
- デバイス互換性（PC, タブレット, スマートフォン）
- 画面サイズ対応（320px〜1920px）

### 10.3 パフォーマンステスト
- ページ読み込み速度
- 画像生成速度
- サーバー負荷テスト 